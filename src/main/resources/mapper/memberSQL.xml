<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="member">
	<select id="selectOneMember" parameterType="m" resultType="m">
		select
			member_no as memberNo,
			member_id as memberId,
			member_nickname as memberNickname,
			member_phone as memberPhone,
			member_city as memberCity,
			member_photo as memberPhoto,
			member_intro as memberIntro,
			enroll_date as enrollDate,
			member_level as memberLevel,
			join_type as joinType
		from member_tbl
		where member_id = #{memberId} 
		<if test="memberPw != null">
		and member_pw = #{memberPw}
		</if>
		<if test="memberPhone != null">
		and member_phone = #{memberPhone}
		</if>
	</select>
	
	<insert id="insertKakao" parameterType="m">
		insert into member_tbl
		values(MEMBER_SEQ.NEXTVAL, #{memberId}, #{memberNickname}, #{memberPhone}, NULL, NULL, NULL, NULL, TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 1, '카카오')
	</insert>
	
	<delete id="deleteMember" parameterType="string">
		delete from member_tbl where member_id = #{_parameter}
	</delete>
	
	<select id="findId" parameterType="m" resultType="m">
		select
			member_id as memberId,
			join_type as joinType
		from member_tbl
		where member_nickname = #{memberNickname} and member_phone = #{memberPhone}
	</select>
	
	<update id="updatePw" parameterType="m">
		update member_tbl
		set member_pw = #{memberPw}
		where member_id = #{memberId}
	</update>
	
	<insert id="insertMember" parameterType="m">
		insert into member_tbl
		values(MEMBER_SEQ.NEXTVAL, #{memberId}, #{memberNickname}, #{memberPhone}, #{memberPw}, NULL, NULL, NULL, TO_CHAR(SYSDATE, 'YYYY-MM-DD'), 1, '일반가입')
	</insert>
	
	<select id="checkPhone" parameterType="m" resultType="m">
		select
			member_id as memberId,
			join_type as joinType
		from member_tbl
		where member_phone = #{memberPhone}
	</select>
	
	<update id="updateMember" parameterType="m">
		update member_tbl
		set 
			<if test="memberPhoto != null">
			member_photo = #{memberPhoto},
			</if>
			member_nickname = #{memberNickname},
			<if test="memberPhone != null">
			member_phone = #{memberPhone},
			</if>
			member_city = #{memberCity},
			member_intro = #{memberIntro}
		where member_id = #{memberId}
	</update>
	
	<select id="selectMyCalendar" parameterType="string" resultType="mc">
		select 
		    wm_no as wmNo,
		    wm_title as wmTitle,
		    substr(wm_meet_start, 0, 10) as startdate,
		    substr(wm_meet_end, 0, 10) as enddate
		from walk_mate_tbl inner join wm_apply_tbl using(wm_no)
		where 
		    member_id = #{_parameter}
		    and apply_stat = 2	
	</select>
</mapper>
